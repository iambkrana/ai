(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{SX51:function(t,s,e){"use strict";e.r(s),e.d(s,"AssessmentPreviewIosPageModule",(function(){return B}));var i=e("ofXK"),n=e("3Pt+"),o=e("TEn/"),a=e("tyNb"),r=e("mrSG"),_=e("tk/3"),l=e("FAH8"),c=e("B7Rs"),d=e("wd/R"),h=e("X7yx"),m=e("5dVO"),u=e("riPR"),b=e("ZJFI"),p=e("1vjY"),g=e("VDsr"),f=e("fXoL");function O(t,s){if(1&t){const t=f.Pb();f.Ob(0,"ion-col",24),f.Wb("click",(function(){f.gc(t);const s=f.Yb().$implicit;return f.Yb(2).ViewVideo(s)})),f.Ob(1,"ion-row",7),f.Ob(2,"p",25),f.mc(3),f.Nb(),f.Nb(),f.Nb()}if(2&t){const t=f.Yb().$implicit;f.Ab(3),f.nc(t.question)}}function v(t,s){if(1&t){const t=f.Pb();f.Ob(0,"ion-col",26),f.Wb("click",(function(){f.gc(t);const s=f.Yb().$implicit;return f.Yb(2).ViewVideo(s)})),f.Ob(1,"ion-row",7),f.Ob(2,"p",25),f.mc(3),f.Nb(),f.Nb(),f.Nb()}if(2&t){const t=f.Yb().$implicit;f.Ab(3),f.nc(t.question)}}function P(t,s){1&t&&f.Mb(0,"img",27)}function C(t,s){1&t&&f.Mb(0,"img",28)}function k(t,s){if(1&t){const t=f.Pb();f.Ob(0,"ion-col",29),f.Ob(1,"ion-button",30),f.Wb("click",(function(){f.gc(t);const s=f.Yb().$implicit;return f.Yb(2).reshoot_video_single(s)})),f.mc(2,"Reshoot"),f.Nb(),f.Nb()}}const R=function(t){return{"background-color":t}},y=function(t){return{color:t}};function w(t,s){if(1&t&&(f.Ob(0,"ion-row",31),f.Ob(1,"ion-col",8),f.Ob(2,"div",32),f.Mb(3,"div",33),f.Ob(4,"p",34),f.mc(5),f.Nb(),f.Nb(),f.Nb(),f.Nb()),2&t){const t=f.Yb().$implicit,s=f.Yb(2);f.Ab(2),f.bc("ngStyle",f.dc(8,R,t.cont_color)),f.Ab(1),f.Cb(s.ProgressClass),f.kc("width",t.percentage+"%"),f.bc("ngStyle",f.dc(10,R,t.pbar_color)),f.Ab(1),f.bc("ngStyle",f.dc(12,y,t.pbfont_color)),f.Ab(1),f.nc(t.progressbar_title)}}function x(t,s){if(1&t&&(f.Ob(0,"ion-row",31),f.Ob(1,"ion-col",8),f.Ob(2,"div",32),f.Mb(3,"div",33),f.Ob(4,"p",34),f.mc(5),f.Nb(),f.Nb(),f.Nb(),f.Nb()),2&t){const t=f.Yb().$implicit,s=f.Yb(2);f.Ab(2),f.bc("ngStyle",f.dc(8,R,t.cont_color)),f.Ab(1),f.Cb(s.ProgressClass),f.kc("width",t.percentage+"%"),f.bc("ngStyle",f.dc(10,R,t.pbar_color)),f.Ab(1),f.bc("ngStyle",f.dc(12,y,t.pbfont_color)),f.Ab(1),f.nc(t.progressbar_title)}}function E(t,s){if(1&t){const t=f.Pb();f.Ob(0,"ion-card",16),f.Ob(1,"ion-row",8),f.lc(2,O,4,1,"ion-col",17),f.lc(3,v,4,1,"ion-col",18),f.Ob(4,"ion-col",19),f.Wb("click",(function(){f.gc(t);const e=s.$implicit;return f.Yb(2).ViewVideo(e)})),f.lc(5,P,1,0,"img",20),f.lc(6,C,1,0,"img",21),f.Nb(),f.lc(7,k,3,0,"ion-col",22),f.Nb(),f.lc(8,w,6,14,"ion-row",23),f.lc(9,x,6,14,"ion-row",23),f.Nb()}if(2&t){const t=s.$implicit,e=f.Yb(2);f.Ab(1),f.Db("uploading-video","UPLOADING"==t.current_status),f.Ab(1),f.bc("ngIf",!1===e.start_upload),f.Ab(1),f.bc("ngIf",!0===e.start_upload),f.Ab(2),f.bc("ngIf","PENDING"==t.upload_status),f.Ab(1),f.bc("ngIf","DONE"==t.upload_status),f.Ab(1),f.bc("ngIf",!1===e.start_upload),f.Ab(1),f.bc("ngIf","UPLOADING"==t.current_status&&"Failed..."!==t.progressbar_title),f.Ab(1),f.bc("ngIf","Failed..."==t.progressbar_title)}}function z(t,s){if(1&t&&(f.Ob(0,"ion-content",7),f.Ob(1,"ion-row",8),f.Ob(2,"ion-col",8),f.Ob(3,"p",9),f.mc(4,"Click on the question to preview your video."),f.Nb(),f.Nb(),f.Nb(),f.Ob(5,"ion-list",7),f.lc(6,E,10,9,"ion-card",10),f.Ob(7,"ion-card",11),f.Ob(8,"ion-row",12),f.Ob(9,"ion-col",13),f.Ob(10,"p",14),f.mc(11,"You are just one step away from your submission."),f.Nb(),f.Nb(),f.Ob(12,"ion-col",13),f.Ob(13,"ion-row",15),f.Ob(14,"ion-col",13),f.Ob(15,"p",9),f.mc(16),f.Nb(),f.Nb(),f.Nb(),f.Nb(),f.Nb(),f.Nb(),f.Nb(),f.Nb()),2&t){const t=f.Yb();f.Ab(6),f.bc("ngForOf",t.assessment_data),f.Ab(10),f.pc("You have made ",t.total_attempts," successful attempts for assessment. The maximum attempts allowed for this assessment are ",t.attempts_allowed,".")}}function A(t,s){if(1&t&&(f.Ob(0,"ion-row",40),f.Ob(1,"ion-col",41),f.mc(2),f.Nb(),f.Nb()),2&t){const t=f.Yb(2);f.Ab(1),f.Cb(t.internet_background),f.Ab(1),f.oc(" ",t.internet_text," ")}}function N(t,s){if(1&t){const t=f.Pb();f.Ob(0,"ion-footer",35),f.lc(1,A,3,3,"ion-row",36),f.Ob(2,"ion-row",11),f.Ob(3,"ion-col",37),f.Ob(4,"ion-button",38),f.Wb("click",(function(){return f.gc(t),f.Yb().upload_videoto_vimeo()})),f.mc(5," UPLOAD YOUR ASSESSMENT "),f.Nb(),f.Nb(),f.Ob(6,"ion-col",37),f.Ob(7,"ion-button",39),f.Wb("click",(function(){return f.gc(t),f.Yb().reshoot_video()})),f.mc(8," RESHOOT VIDEO "),f.Nb(),f.Nb(),f.Nb(),f.Nb()}if(2&t){const t=f.Yb();f.Ab(1),f.bc("ngIf",t.internet_indicator)}}function M(t,s){if(1&t&&(f.Ob(0,"ion-row",40),f.Ob(1,"ion-col",41),f.mc(2),f.Nb(),f.Nb()),2&t){const t=f.Yb(2);f.Ab(1),f.Cb(t.internet_background),f.Ab(1),f.oc(" ",t.internet_text," ")}}function S(t,s){if(1&t){const t=f.Pb();f.Ob(0,"ion-footer",35),f.lc(1,M,3,3,"ion-row",36),f.Ob(2,"ion-row",11),f.Ob(3,"ion-col",8),f.Ob(4,"ion-button",42),f.Wb("click",(function(){return f.gc(t),f.Yb().upload_videoto_vimeo()})),f.mc(5," UPLOAD YOUR ASSESSMENT "),f.Nb(),f.Nb(),f.Nb(),f.Nb()}if(2&t){const t=f.Yb();f.Ab(1),f.bc("ngIf",t.internet_indicator)}}function I(t,s){if(1&t&&(f.Ob(0,"ion-row",40),f.Ob(1,"ion-col",41),f.mc(2),f.Nb(),f.Nb()),2&t){const t=f.Yb(2);f.Ab(1),f.Cb(t.internet_background),f.Ab(1),f.oc(" ",t.internet_text," ")}}function T(t,s){if(1&t){const t=f.Pb();f.Ob(0,"ion-footer",35),f.lc(1,I,3,3,"ion-row",36),f.Ob(2,"ion-row",11),f.Ob(3,"ion-col",8),f.Ob(4,"ion-button",42),f.Wb("click",(function(){return f.gc(t),f.Yb().upload_videoto_vimeo()})),f.mc(5," UPLOAD YOUR ASSESSMENT "),f.Nb(),f.Nb(),f.Nb(),f.Nb()}if(2&t){const t=f.Yb();f.Ab(1),f.bc("ngIf",t.internet_indicator)}}var j=function(t){return t[t.Online=0]="Online",t[t.Offline=1]="Offline",t}({});const D=[{path:"",component:(()=>{class t{constructor(t,s,e,i,n,o,a,r,_,l,c,d,h,m){this.platform=t,this.alertController=s,this.menu=e,this.navCtrl=i,this.modalCtrl=n,this.file=o,this.transfer=a,this.zone=r,this.http=_,this.events=l,this.ionLoader=c,this.ionAlert=d,this.database=h,this.atom=m,this.btn_isclicked=!1,this.json_profile={user_id:"",company_id:"",company_name:"",first_name:"",last_name:"",fullname:"",email:"",mobile:"",photo:"",co_photo:"",otp_pending:"",otc_pending:"",co_pending:"",token_no:"",payload:"",webauto_login:"",default_dboard_tab:""},this.total_attempts=0,this.attempts_allowed=0,this.assessment_form_submit={action:"submit_assessment_details_ftp",token_no:"",payload:"",assessment_id:"",trans_id:"",question_id:"",video_id:"",video_size:0,video_date:"",addeddate:"",total_question:"",session_id:"",token_id:"",archive_id:"",start_time:"",end_time:""},this.assessment_status_form_submit={action:"submit_assessment_status_ftp",token_no:"",payload:"",assessment_id:"",total_question:"",total_uploaded:""},this.assessment_upload_log_form_submit={action:"submit_assessment_upload_log",token_no:"",payload:"",assessment_id:"",trans_id:"",question_id:"",log_status:""},this.assessment_truncate_reshoot_form={action:"submit_truncate_reshoot",token_no:"",payload:"",assessment_id:""},this.assessment_truncate_single_reshoot_form={action:"submit_truncate_single_reshoot",token_no:"",payload:"",assessment_id:"",trans_id:"",question_id:""},this.assessment_attempts_form_submit={action:"submit_assessment_attempts",token_no:"",payload:"",assessment_id:""},this.json_get_archive={action:"get_single_archive",token_no:"",payload:"",sessionId:"",tokenId:"",archiveId:""},this.showPage=!1,this.start_upload=!1,this.openedModals=!1,this.videoCount=0,this.videoTotal=0,this.lock_reshoot_button=!1,this.lock_reshoot_single_button=!1,this.lock_upload_button=!1,this.vimeo_upload_status=[],this.vimeocallback_attempts=0,this.vimeostatus_array=[],this.uploadChain_array=[],this.units=["Bytes","KB","MB","GB","TB","PB"],this.current_video_index=0,this.hideBtnReshoot=!1,this.internet_indicator=!1,this.menu.enable(!0),this.hideBtnReshoot=!1,this.assessment_messages=this.atom.get_assessment_messages(),Object.keys(this.assessment_messages).length>0&&(this.NO_RECORD_FOUND=this.assessment_messages.NO_RECORD_FOUND,this.INTERNET_DISCONNECTED=this.assessment_messages.INTERNET_DISCONNECTED,this.INTERNET_HARDWARE_DISCONNECTED=this.assessment_messages.INTERNET_HARDWARE_DISCONNECTED,this.VIMEO_TRANSCODING_STUCK=this.assessment_messages.VIMEO_TRANSCODING_STUCK,this.VIMEO_CALLBACK_ATTEMPTS=this.assessment_messages.VIMEO_CALLBACK_ATTEMPTS,this.VIMEO_CALLBACK_TIMER=this.assessment_messages.VIMEO_CALLBACK_TIMER,this.PBWRAPPER_BG=this.assessment_messages.PBWRAPPER_BG,this.PBFONT_CLR=this.assessment_messages.PBFONT_CLR,this.PBU_BG=this.assessment_messages.PBU_BG,this.PBC_BG=this.assessment_messages.PBC_BG,this.PBF_BG=this.assessment_messages.PBF_BG,this.PBS_BG=this.assessment_messages.PBS_BG,this.UPLOAD_POPUP_TITLE=this.assessment_messages.UPLOAD_POPUP_TITLE,this.UPLOAD_POPUP_MESSAGE_HEAD=this.assessment_messages.UPLOAD_POPUP_MESSAGE_HEAD,this.UPLOAD_POPUP_MESSAGE_SUB=this.assessment_messages.UPLOAD_POPUP_MESSAGE_SUB,parseInt(this.VIMEO_CALLBACK_TIMER)<=0&&(this.VIMEO_CALLBACK_TIMER=2e4,this.TEMP_VIMEO_CALLBACK_TIMER=2e4))}ionViewDidLeave(){try{this.events.unsubscribe("loginnetwork:online"),this.events.unsubscribe("loginnetwork:offline")}catch(t){}}ionViewWillEnter(){this.platform.ready().then(()=>{try{this.events.unsubscribe("RETRY_UPLOAD")}catch(t){}this.events.subscribe("RETRY_UPLOAD",t=>{this.upload_published||(this.upload_published=!0,this.show_confirmation("Howdy User!",t))})})}ngOnInit(){this.json_navparam=this.atom.navigation_param_get(),this.assessment_detail=this.json_navparam.param_assessment_detail,this.vimeo_credentials=this.json_navparam.param_vimeo_credentials,this.total_attempts=this.json_navparam.param_total_attempts,this.attempts_allowed=this.json_navparam.param_attempts_allowed,this.assessment_id=this.assessment_detail.assessment_id,this.ProgressClass="dcp-loader-green fadein-out",this.showPage=!1,this.start_upload=!1,this.videoCount=0,this.videoTotal=0,this.assessment_form_submit.total_question=this.assessment_detail.total_question,this.assessment_status_form_submit.total_question=this.assessment_detail.total_question,this.assessment_status_form_submit.assessment_id=this.assessment_id,this.assessment_attempts_form_submit.assessment_id=this.assessment_id,this.assessment_truncate_reshoot_form.assessment_id=this.assessment_id,this.assessment_truncate_single_reshoot_form.assessment_id=this.assessment_id,this.assessment_upload_log_form_submit.assessment_id=this.assessment_id,this.lock_reshoot_button=!1,this.lock_reshoot_single_button=!1,this.lock_upload_button=!1,this.upload_published=!1,this.alertPresented=!1,parseFloat(this.assessment_detail.video_uploaded_count)>0&&(this.hideBtnReshoot=!0),this.initializeApp()}initializeApp(){this.platform.ready().then(t=>{this.database.storage_get("device").then(t=>{t.token_no&&t.payload&&(this.json_profile=t,this.assessment_form_submit.token_no=t.token_no,this.assessment_form_submit.payload=t.payload,this.assessment_truncate_reshoot_form.token_no=t.token_no,this.assessment_truncate_reshoot_form.payload=t.payload,this.assessment_truncate_single_reshoot_form.token_no=t.token_no,this.assessment_truncate_single_reshoot_form.payload=t.payload,this.assessment_upload_log_form_submit.token_no=t.token_no,this.assessment_upload_log_form_submit.payload=t.payload,this.assessment_attempts_form_submit.token_no=t.token_no,this.assessment_attempts_form_submit.payload=t.payload,this.assessment_status_form_submit.token_no=t.token_no,this.assessment_status_form_submit.payload=t.payload,this.json_get_archive.token_no=t.token_no,this.json_get_archive.payload=t.payload,this.init_preview())}).catch(t=>{}),window.addEventListener("online",()=>{this.internetStatus=j.Online,this.zone.run(()=>{this.internet_background="int-green",this.internet_text="YOU ARE ONLINE"}),this.internet_timer=setTimeout(()=>{this.zone.run(()=>{this.internet_indicator=!1})},1e4)}),window.addEventListener("offline",()=>{this.internetStatus=j.Offline,this.zone.run(()=>{this.internet_background="int-red",this.internet_text="YOU ARE OFFLINE",this.internet_indicator=!0})})})}sortby_transid(t){return t.sort((t,s)=>parseFloat(t.trans_id)>parseFloat(s.trans_id)?1:parseFloat(t.trans_id)<parseFloat(s.trans_id)?-1:0)}init_preview(){this.start_upload=!1,this.assessment_data=[],this.database.storage_get("assessment").then(t=>{this.videoTotal=0,t&&Object.keys(t).length>0?(this.videoTotal=Object.keys(t).length,t=this.sortby_transid(t),Object.keys(t).forEach(s=>{if(parseFloat(t[s].user_id)==parseFloat(this.json_profile.user_id)){let e=t[s].is_uploaded;t[s].assessment_id==this.assessment_id&&0==e&&(this.assessment_data.push(t[s]),this.assessment_data[s].file_size=1)}}),this.showPage=!0):this.showPage=!0}).catch(t=>{this.showPage=!0})}reshoot_video(){return Object(r.a)(this,void 0,void 0,(function*(){let t=this;if(this.lock_reshoot_button);else{this.lock_reshoot_button=!0;const s=yield this.alertController.create({header:"Please Confirm",subHeader:"You are about to go Live. Your previous video will be overwritten!",backdropDismiss:!1,buttons:[{text:"Cancel",role:"no",handler:()=>{this.lock_reshoot_button=!1}},{text:"Reshoot",handler:()=>{this.internetStatus===j.Offline?(this.lock_reshoot_button=!1,this.ionAlert.show_alert("Retry","Unable to complete the reshoot process, Please click on RESHOOT VIDEO button again.")):this.atom.http_post(this.assessment_truncate_reshoot_form).subscribe(s=>{if(1==s.success){let s=[];this.database.storage_get("assessment").then(e=>{if(e&&Object.keys(e).length>0){let i=Promise.resolve();Object.keys(e).forEach(t=>{i=i.then(()=>new Promise((i,n)=>{parseFloat(e[t].user_id)==parseFloat(this.json_profile.user_id)?(this.temp_assessment_id=e[t].assessment_id,this.temp_assessment_id==this.assessment_id||s.push(e[t]),i({status:"SUCCESS"})):(s.push(e[t]),i({status:"SUCCESS"}))}))}),Promise.all([i]).then((function(e){t.database.storage_set("assessment",s).then(s=>{t.lock_reshoot_button=!1,t.atom.navigation_param_set({assessment_detail:t.assessment_detail,vimeo_credentials:t.vimeo_credentials}).subscribe(s=>{t.navCtrl.navigateRoot("/assessment-quiz")},s=>{t.atom.presentToast("Application error, parameter failed to set.")})}).catch(s=>{t.lock_reshoot_button=!1})}))}}).catch(t=>{this.lock_reshoot_button=!1})}else this.lock_reshoot_button=!1,this.ionAlert.show_alert("Retry","Unable to complete the reshoot process, Please click on RESHOOT VIDEO button again.")},t=>{this.lock_reshoot_button=!1},()=>{this.lock_reshoot_button=!1})}}]});yield s.present()}}))}reshoot_video_single(t){return Object(r.a)(this,void 0,void 0,(function*(){if(this.lock_reshoot_single_button);else if(this.lock_reshoot_single_button=!0,this.assessment_truncate_single_reshoot_form.trans_id=t.trans_id,this.assessment_truncate_single_reshoot_form.question_id=t.question_id,""!=t.trans_id&&""!=t.question_id){const t=yield this.alertController.create({header:"Please Confirm",subHeader:"You are about to go Live. Your previous video will be overwritten!",backdropDismiss:!1,buttons:[{text:"Cancel",role:"no",handler:()=>{this.lock_reshoot_single_button=!1}},{text:"Reshoot",handler:()=>{this.internetStatus===j.Offline?(this.lock_reshoot_single_button=!1,this.ionAlert.show_alert("Retry","Unable to complete the reshoot process, Please click on RESHOOT VIDEO button again.")):this.atom.http_post(this.assessment_truncate_single_reshoot_form).subscribe(t=>{if(1==t.success){let t=[];this.database.storage_get("assessment").then(s=>{s&&Object.keys(s).length>0&&(Object.keys(s).forEach(e=>{parseFloat(s[e].user_id)==parseFloat(this.json_profile.user_id)?(this.temp_video_url="",this.temp_trans_id="",this.temp_question_id="",this.temp_video_url=s[e].video_url,this.temp_trans_id=s[e].trans_id,this.temp_question_id=s[e].question_id,this.temp_assessment_id=s[e].assessment_id,this.temp_assessment_id==this.assessment_id&&this.temp_trans_id==this.assessment_truncate_single_reshoot_form.trans_id&&this.temp_question_id==this.assessment_truncate_single_reshoot_form.question_id||t.push(s[e])):t.push(s[e])}),this.database.storage_set("assessment",t).then(t=>{this.lock_reshoot_single_button=!1,this.atom.navigation_param_set({assessment_detail:this.assessment_detail,vimeo_credentials:this.vimeo_credentials}).subscribe(t=>{this.navCtrl.navigateRoot("/assessment-quiz")},t=>{this.atom.presentToast("Application error, parameter failed to set.")})}).catch(t=>{this.lock_reshoot_single_button=!1}))}).catch(t=>{this.lock_reshoot_single_button=!1})}else this.lock_reshoot_single_button=!1,this.ionAlert.show_alert("Retry","Unable to complete the reshoot process, Please click on RESHOOT VIDEO button again.")},t=>{this.lock_reshoot_single_button=!1},()=>{this.lock_reshoot_single_button=!1})}}]});yield t.present()}else this.ionAlert.show_alert("Retry","Transaction Id Or Assessment Question Id is missing.")}))}filterItems(t){return t.filter(t=>"ERROR"===t)}upload_videoto_vimeo(){let t=this;this.vimeostatus_array=[],this.uploadChain_array=[],this.alertPresented=!1,this.upload_published=!1,this.current_video_index=0,this.lock_upload_button||(this.lock_upload_button=!0,this.database.storage_get("assessment").then(s=>{if(s&&Object.keys(s).length>0)if(this.start_upload=!0,this.videoCount=0,this.internetStatus===j.Offline)this.lock_reshoot_single_button=!1,this.events.publish("RETRY_UPLOAD",this.INTERNET_DISCONNECTED);else try{let e=Promise.resolve();for(let t=0;t<Object.keys(s).length;t++)e=e.then(()=>new Promise((e,i)=>{let n=s[t].assessment_id;if(parseFloat(s[t].user_id)==parseFloat(this.json_profile.user_id)&&n==this.assessment_id){this.progressCounter=0,this.current_video_index=t,this.assessment_data[t].current_status="UPLOADING",this.assessment_data[t].percentage=0,this.assessment_data[t].progressbar_title="Uploading...",this.assessment_data[t].cont_color=this.PBWRAPPER_BG,this.assessment_data[t].pbar_color=this.PBU_BG,this.assessment_data[t].pbfont_color=this.PBFONT_CLR,this.videoCount=this.videoCount+1;let i=s[t].assessment_id,n=s[t].trans_id,o=s[t].question_id,a=s[t].video_url,r=s[t].addeddate,_=s[t].session_id,l=s[t].token_id,c=s[t].archive_id,d=s[t].start_time,h=s[t].end_time;this.file_name=a,this.file_size=1,this.assessment_form_submit.assessment_id=i,this.assessment_form_submit.trans_id=n,this.assessment_form_submit.question_id=o,this.assessment_form_submit.addeddate=r,this.assessment_form_submit.session_id=_,this.assessment_form_submit.token_id=l,this.assessment_form_submit.archive_id=c,this.assessment_form_submit.start_time=d,this.assessment_form_submit.end_time=h,this.json_get_archive.sessionId=_,this.json_get_archive.tokenId=l,this.json_get_archive.archiveId=c,this.internetStatus===j.Offline?(this.uploadChain_array[this.current_video_index]="ERROR",e({status:"ERROR"})):(this.assessment_upload_log_form_submit.trans_id=n,this.assessment_upload_log_form_submit.question_id=o,this.assessment_upload_log_form_submit.log_status="UPLOADING",this.atom.http_post(this.assessment_upload_log_form_submit).subscribe(s=>{1==s.success?this.init_video_vimeo(t,a,this.file_size).then(t=>{"SUCCESS"===t.status?(this.uploadChain_array[this.current_video_index]="SUCCESS",e({status:"SUCCESS"})):(this.zone.run(()=>{this.assessment_data[this.current_video_index].current_status="",this.assessment_data[this.current_video_index].percentage=100,this.assessment_data[this.current_video_index].progressbar_title="Failed...",this.assessment_data[this.current_video_index].pbar_color=this.PBF_BG}),this.uploadChain_array[this.current_video_index]="ERROR",e({status:"ERROR"}))}).catch(()=>{this.zone.run(()=>{this.assessment_data[this.current_video_index].current_status="",this.assessment_data[this.current_video_index].percentage=100,this.assessment_data[this.current_video_index].progressbar_title="Failed...",this.assessment_data[this.current_video_index].pbar_color=this.PBF_BG}),this.uploadChain_array[this.current_video_index]="ERROR",e({status:"ERROR"})}):(this.zone.run(()=>{this.assessment_data[this.current_video_index].current_status="",this.assessment_data[this.current_video_index].percentage=100,this.assessment_data[this.current_video_index].progressbar_title="Failed...",this.assessment_data[this.current_video_index].pbar_color=this.PBF_BG}),this.uploadChain_array[this.current_video_index]="ERROR",e({status:"ERROR"}))},t=>{this.zone.run(()=>{this.assessment_data[this.current_video_index].current_status="",this.assessment_data[this.current_video_index].percentage=100,this.assessment_data[this.current_video_index].progressbar_title="Failed...",this.assessment_data[this.current_video_index].pbar_color=this.PBF_BG}),this.uploadChain_array[this.current_video_index]="ERROR",e({status:"ERROR"})},()=>{}))}else this.uploadChain_array[this.current_video_index]="ERROR",e({status:"ERROR"})}));Promise.all([e]).then((function(s){if(Object.keys(t.filterItems(t.uploadChain_array)).length>0)t.lock_upload_button=!1,t.events.publish("RETRY_UPLOAD",t.VIMEO_TRANSCODING_STUCK);else{let s=[];t.database.storage_get("assessment").then(e=>{e&&Object.keys(e).length>0&&(Object.keys(e).forEach(i=>{parseFloat(e[i].user_id)==parseFloat(t.json_profile.user_id)&&(t.temp_assessment_id=e[i].assessment_id,t.temp_assessment_id==t.assessment_id||s.push(e[i]))}),t.database.storage_set("assessment",s).then(s=>{t.lock_upload_button=!1,t.atom.navigation_param_set({type:"MSG"}).subscribe(s=>{t.navCtrl.navigateRoot("/assessment-success")},s=>{t.atom.presentToast("Application error, parameter failed to set.")})}).catch(s=>{t.lock_upload_button=!1,t.atom.navigation_param_set({type:"MSG"}).subscribe(s=>{t.navCtrl.navigateRoot("/assessment-success")},s=>{t.atom.presentToast("Application error, parameter failed to set.")})}))}).catch(s=>{t.lock_upload_button=!1,t.atom.navigation_param_set({type:"MSG"}).subscribe(s=>{t.navCtrl.navigateRoot("/assessment-success")},s=>{t.atom.presentToast("Application error, parameter failed to set.")})})}}))}catch(e){this.lock_upload_button=!1}}).catch(t=>{this.lock_upload_button=!0}))}init_video_vimeo(t,s,e){return Object(r.a)(this,void 0,void 0,(function*(){return new Promise((e,i)=>Object(r.a)(this,void 0,void 0,(function*(){this.zone.run(()=>{this.progressCounter=25,this.assessment_data[this.current_video_index].percentage=this.progressCounter});try{this.atom.http_post(this.json_get_archive).subscribe(i=>Object(r.a)(this,void 0,void 0,(function*(){if(1==i.success)if(this.zone.run(()=>{this.progressCounter=50,this.assessment_data[this.current_video_index].percentage=this.progressCounter}),this.assessment_form_submit.video_size=i.archive_size,i.archive_size>0){let o="Video Uploaded By "+this.json_profile.fullname+", Company Name "+this.json_profile.company_name,a="https://api.vimeo.com/me/videos",l={upload:{approach:"pull",size:i.archive_size,link:JSON.parse(i.archive_url)},name:this.file_name?this.file_name:"Blank-"+d().utcOffset("+05:30").format("YYYYMMDDHHmmss")+".mp4",description:o,privacy:{comments:"nobody",download:"false",embed:"public",view:"unlisted"},token:this.vimeo_credentials.access_token,client_id:this.vimeo_credentials.client_id,client_secret:this.vimeo_credentials.client_secret},c={headers:new _.d({Authorization:"bearer "+this.vimeo_credentials.access_token,"Content-Type":"application/json",Accept:"application/vnd.vimeo.*+json;version=3.4"})};if(this.internetStatus===j.Offline)e({status:"ERROR"});else try{this.http.post(a,l,c).subscribe(i=>Object(r.a)(this,void 0,void 0,(function*(){let n=i;this.zone.run(()=>{this.progressCounter=75,this.assessment_data[this.current_video_index].percentage=this.progressCounter});let o=n.upload.upload_link;this.assessment_form_submit.video_id=n.uri,yield this.submit_to_server(t,o,s).then(t=>Object(r.a)(this,void 0,void 0,(function*(){"UPLOADED"===t.status?e({status:"SUCCESS"}):(this.assessment_upload_log_form_submit.log_status="FAILED",yield this.atom.http_post(this.assessment_upload_log_form_submit).subscribe(t=>{e({status:"ERROR"})},t=>{e({status:"ERROR"})},()=>{}))}))).catch(()=>Object(r.a)(this,void 0,void 0,(function*(){this.assessment_upload_log_form_submit.log_status="FAILED",yield this.atom.http_post(this.assessment_upload_log_form_submit).subscribe(t=>{e({status:"ERROR"})},t=>{e({status:"ERROR"})},()=>{})})))})),t=>{e({status:"ERROR"})},()=>{})}catch(n){e({status:"ERROR"})}}else e({status:"ERROR"});else e({status:"ERROR"})})),t=>{},()=>{})}catch(i){}})))}))}submit_to_server(t,s,e){return new Promise((t,s)=>Object(r.a)(this,void 0,void 0,(function*(){if(this.internetStatus===j.Offline)t({status:"ERROR"});else try{setTimeout(()=>{this.internetStatus===j.Offline?t({status:"ERROR"}):this.atom.http_post(this.assessment_form_submit).subscribe(s=>{if(1==s.success){let s=this,e=[],i=[];this.database.storage_get("assessment").then(n=>{if(n&&Object.keys(n).length>0){let o=Promise.resolve();for(let t=0;t<Object.keys(n).length;t++)parseFloat(n[t].user_id)==parseFloat(this.json_profile.user_id)&&(o=o.then(()=>new Promise((s,o)=>{n[t].assessment_id==this.assessment_form_submit.assessment_id&&n[t].trans_id==this.assessment_form_submit.trans_id&&n[t].question_id==this.assessment_form_submit.question_id&&n[t].archive_id==this.assessment_form_submit.archive_id?(n[t].is_uploaded=1,e.push(n[t]),i.push("SUCCESS"),s({status:"SUCCESS"})):(e.push(n[t]),i.push("SUCCESS"),s({status:"SUCCESS"}))})));Promise.all([o]).then((function(n){Object.keys(s.filterItems(i)).length>0?t({status:"ERROR"}):s.database.storage_set("assessment",e).then(e=>{s.zone.run(()=>{s.assessment_data[s.current_video_index].upload_status="DONE",s.assessment_data[s.current_video_index].current_status="DONE",s.assessment_data[s.current_video_index].percentage=100,s.assessment_data[s.current_video_index].progressbar_title="Successful...",s.assessment_data[s.current_video_index].pbar_color=s.PBS_BG}),t({status:"UPLOADED"})}).catch(e=>{t({status:"ERROR"}),s.lock_reshoot_button=!1})}))}}).catch(s=>{t({status:"ERROR"})})}else t({status:"ERROR"})},s=>{t({status:"ERROR"})},()=>{})},1500)}catch(s){t({status:"ERROR"})}})))}ViewVideo(t){return Object(r.a)(this,void 0,void 0,(function*(){this.json_get_archive.sessionId=t.session_id,this.json_get_archive.tokenId=t.token_id,this.json_get_archive.archiveId=t.archive_id,this.atom.http_post(this.json_get_archive).subscribe(s=>Object(r.a)(this,void 0,void 0,(function*(){if(1==s.success)if("available"===s.archive_status){this.vonage_video_url=JSON.parse(s.archive_url);const e=yield this.modalCtrl.create({component:g.a,componentProps:{video_details:t,video_url:this.vonage_video_url},swipeToClose:!0,presentingElement:yield this.modalCtrl.getTop()});yield e.present(),yield e.onWillDismiss()}else this.vonage_video_url="",this.atom.presentToast("Unable to fetch video link. status is under process, please try again");else this.vonage_video_url="",this.atom.presentToast("Unable to fetch video details, Please try again")})),t=>{this.vonage_video_url=""},()=>{})}))}show_confirmation(t,s){return Object(r.a)(this,void 0,void 0,(function*(){let e;const i=yield this.alertController.create({header:t,subHeader:s,backdropDismiss:!1,buttons:[{text:"Close",handler:()=>{this.init_preview()}}]});return yield i.present(),yield i.onDidDismiss().then(t=>{e=t}),e}))}backto_dashboard(){this.navCtrl.navigateRoot("/go-live/assessment-live")}}return t.\u0275fac=function(s){return new(s||t)(f.Lb(o.T),f.Lb(o.b),f.Lb(o.Q),f.Lb(o.S),f.Lb(o.R),f.Lb(l.a),f.Lb(c.a),f.Lb(f.z),f.Lb(_.a),f.Lb(u.a),f.Lb(m.a),f.Lb(h.a),f.Lb(b.a),f.Lb(p.a))},t.\u0275cmp=f.Fb({type:t,selectors:[["app-assessment-preview-ios"]],decls:12,vars:4,consts:[[1,"ion-no-border","ion-no-shadow"],["slot","start"],["autoHide","false"],[1,"close-containers"],["src","assets/images/close.png","alt","",1,"close-end",3,"click"],["class","ion-no-margin ion-no-padding",4,"ngIf"],["class","ion-no-margin ion-no-padding ion-no-border ion-no-shadow","position","bottom",4,"ngIf"],[1,"ion-no-margin","ion-no-padding"],["size","12","size-sx","12","size-sm","12","size-md","12","size-lg","12","size-xl","12",1,"ion-no-margin","ion-no-padding"],[1,"sub-title"],["lines","none","class","ion-no-margin ion-no-padding shadow-box",4,"ngFor","ngForOf"],["lines","none",1,"ion-no-margin","ion-no-padding"],["lines","none",1,"main-container","ion-text-center"],["size","12","size-sx","12","size-sm","12","size-md","12","size-lg","12","size-xl","12"],[1,"heading"],["lines","none",1,"reshoot-panel"],["lines","none",1,"ion-no-margin","ion-no-padding","shadow-box"],["class","ion-no-margin ion-no-padding","col-8","","col-sm-8","","col-md-8","","col-lg-8","","col-xl-8","",3,"click",4,"ngIf"],["class","ion-no-margin ion-no-padding col-paddings","size","10","size-sx","10","size-sm","10","size-md","10","size-lg","10","size-xl","10",3,"click",4,"ngIf"],["size","2","size-sx","2","size-sm","2","size-md","2","size-lg","2","size-xl","2",1,"ion-no-margin","ion-no-padding","col-paddings","video-img-panel",3,"click"],["src","assets/images/record.png","alt","Awarathon","class","video-img",4,"ngIf"],["src","assets/images/record_done.png","alt","Awarathon","class","video-img",4,"ngIf"],["class","ion-no-margin ion-no-padding col-paddings video-img-panel","size","2","size-sx","2","size-sm","2","size-md","2","size-lg","2","size-xl","2",4,"ngIf"],["class","ion-no-margin ion-no-padding","size","12","size-sx","12","size-sm","12","size-md","12","size-lg","12","size-xl","12","ht20","",4,"ngIf"],["col-8","","col-sm-8","","col-md-8","","col-lg-8","","col-xl-8","",1,"ion-no-margin","ion-no-padding",3,"click"],[1,"video-heading"],["size","10","size-sx","10","size-sm","10","size-md","10","size-lg","10","size-xl","10",1,"ion-no-margin","ion-no-padding","col-paddings",3,"click"],["src","assets/images/record.png","alt","Awarathon",1,"video-img"],["src","assets/images/record_done.png","alt","Awarathon",1,"video-img"],["size","2","size-sx","2","size-sm","2","size-md","2","size-lg","2","size-xl","2",1,"ion-no-margin","ion-no-padding","col-paddings","video-img-panel"],["size","large","fill","solid","expand","block",1,"btnreshootquiz",3,"click"],["size","12","size-sx","12","size-sm","12","size-md","12","size-lg","12","size-xl","12","ht20","",1,"ion-no-margin","ion-no-padding"],[1,"dcp-wrapper",3,"ngStyle"],[3,"ngStyle"],[1,"percent",3,"ngStyle"],["position","bottom",1,"ion-no-margin","ion-no-padding","ion-no-border","ion-no-shadow"],["class","ion-no-margin ion-no-padding","internet-container","",4,"ngIf"],["col-6","",1,"ion-no-margin","ion-no-padding"],["size","large","fill","solid","expand","block",1,"btnupload",3,"click"],["size","large","fill","solid","expand","block",1,"btnreshoot",3,"click"],["internet-container","",1,"ion-no-margin","ion-no-padding"],["size","12","no-padding","","no-margin","","internet-container",""],["size","large","fill","solid","expand","block",1,"btnuploadfull",3,"click"]],template:function(t,s){1&t&&(f.Ob(0,"ion-header",0),f.Ob(1,"ion-toolbar"),f.Ob(2,"ion-buttons",1),f.Mb(3,"ion-menu-button",2),f.Nb(),f.Ob(4,"ion-title"),f.mc(5,"Preview Assessment"),f.Nb(),f.Ob(6,"div",3),f.Ob(7,"img",4),f.Wb("click",(function(){return s.backto_dashboard()})),f.Nb(),f.Nb(),f.Nb(),f.Nb(),f.lc(8,z,17,3,"ion-content",5),f.lc(9,N,9,1,"ion-footer",6),f.lc(10,S,6,1,"ion-footer",6),f.lc(11,T,6,1,"ion-footer",6)),2&t&&(f.Ab(8),f.bc("ngIf",!0===s.showPage),f.Ab(1),f.bc("ngIf",s.total_attempts<s.attempts_allowed&&!0===s.showPage&&!1===s.start_upload&&0==s.hideBtnReshoot),f.Ab(1),f.bc("ngIf",s.total_attempts<s.attempts_allowed&&!0===s.showPage&&!1===s.start_upload&&1==s.hideBtnReshoot),f.Ab(1),f.bc("ngIf",s.total_attempts>=s.attempts_allowed&&!0===s.showPage&&!1===s.start_upload))},directives:[o.q,o.M,o.i,o.y,o.L,i.i,o.m,o.B,o.l,o.w,i.h,o.j,o.h,i.j,o.o],styles:['ion-menu-button[_ngcontent-%COMP%]{--color:var(--ion-color-primary-contrast)!important}.hide-me[_ngcontent-%COMP%]{display:none}.show-me[_ngcontent-%COMP%]{display:block}.uploading-video[_ngcontent-%COMP%]{background-color:#9adccb}.item-inner[_ngcontent-%COMP%]{padding-right:0!important}ion-label[_ngcontent-%COMP%]{margin:13px 0!important}.col-paddings[_ngcontent-%COMP%]{padding:15px 0}ion-card[_ngcontent-%COMP%]{box-shadow:none!important;width:100%}.main-container[_ngcontent-%COMP%]{height:100%;margin-top:20px;margin-bottom:20px}.center-vertical-horizontal[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.button-spinner[_ngcontent-%COMP%]{display:flex}.btnupload[_ngcontent-%COMP%]{padding:0 4px 0 0!important}.btnupload[_ngcontent-%COMP%], .btnuploadfull[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;font-size:1.3rem;font-weight:400;text-transform:none;--box-shadow:none;--border-radius:0px;--background:var(--ion-color-primary);--background-focused:var(--ion-color-primary);--background-hover:var(--ion-color-primary);--color:var(--ion-color-primary-contrast);height:45px;margin:0!important}.btnreshootquiz[_ngcontent-%COMP%], .btnuploadfull[_ngcontent-%COMP%]{padding:0!important}.btnreshootquiz[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;font-size:1.2rem;font-weight:400;text-transform:none;--box-shadow:none;--border-radius:0px;--background:var(--ion-color-primary);--background-focused:var(--ion-color-primary);--background-hover:var(--ion-color-primary);--color:var(--ion-color-primary-contrast);height:26px;margin:7px 5px 0 0!important}.btnuploadfull[_ngcontent-%COMP%]:hover:not(.disable-hover){background-color:var(--ion-color-primary)!important}.btnreshoot[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;font-size:1.3rem;font-weight:400;text-transform:none;--box-shadow:none;--border-radius:0px;--background:var(--ion-color-primary);--background-focused:var(--ion-color-primary);--background-hover:var(--ion-color-primary);--color:var(--ion-color-primary-contrast);height:45px;padding:0!important;margin:0!important}.btnreshoot[_ngcontent-%COMP%]:hover:not(.disable-hover){background-color:#dadada!important}.reshoot-panel[_ngcontent-%COMP%]{align-self:center;align-items:center}.reshoot-panel[_ngcontent-%COMP%], [shadow-box][_ngcontent-%COMP%]{text-align:center;align-content:center}[shadow-box][_ngcontent-%COMP%]{width:100%!important;background-color:#f7f7f7;height:auto!important;border-bottom:1px solid #fff!important;display:inline-block;vertical-align:top;margin-top:2px!important}.video-img[_ngcontent-%COMP%]{-o-object-fit:cover!important;object-fit:cover!important;align-self:center;display:flex;text-align:center;height:40px;width:40px;margin:0 auto}.video-heading[_ngcontent-%COMP%]{min-height:50px;font-size:1.3rem;font-weight:500;color:#393e41;letter-spacing:0;padding:15px 0}.video-heading[_ngcontent-%COMP%], [video-size][_ngcontent-%COMP%]{width:99%;height:auto!important;margin:0 5px 0 15px!important;text-align:justify;white-space:normal}[video-size][_ngcontent-%COMP%]{font-size:1.4rem;font-weight:600;color:#f53d3d;word-break:break-word;word-spacing:normal;min-height:22px;padding:0}.video-author[_ngcontent-%COMP%]{font-size:1.4rem;font-weight:400;color:#393e41;margin:5px 0 0 15px!important}.vscorll[_ngcontent-%COMP%]{height:200px}.scroll-content[_ngcontent-%COMP%]{margin-top:70px;padding:0!important}.heading[_ngcontent-%COMP%]{font-size:1.4rem;line-height:2rem;vertical-align:middle;color:#feffff;margin-bottom:20px!important;background:#54419a;border-radius:7px;min-height:50px;padding:15px 0}.heading[_ngcontent-%COMP%], .sub-title[_ngcontent-%COMP%]{font-weight:700;text-align:center;white-space:normal}.sub-title[_ngcontent-%COMP%]{font-size:1.3rem;line-height:1.6rem;color:#f53d3d;margin:0 auto!important;height:50px;padding:15px}.sub-heading-i[_ngcontent-%COMP%]{font-size:1.6rem;font-weight:500;line-height:22px;color:#3e4d55;text-align:justify;-moz-text-align-last:center;text-align-last:center;margin:10px 0 0}.upload-sub-heading[_ngcontent-%COMP%]{font-size:1.8rem;line-height:1.8rem}.upload-heading[_ngcontent-%COMP%], .upload-sub-heading[_ngcontent-%COMP%]{font-weight:700;text-align:center;vertical-align:middle;color:#47cfad;margin-bottom:20px!important}.upload-heading[_ngcontent-%COMP%]{font-size:2.2rem;line-height:2.2rem}.progress-wrapper[_ngcontent-%COMP%]{margin:0!important;padding:0!important;position:absolute;width:100%!important;background:#e9e9e9!important;float:left}.dcp-wrapper[_ngcontent-%COMP%], .progress-wrapper[_ngcontent-%COMP%], [ht20][_ngcontent-%COMP%]{height:20px!important}.dcp-wrapper[_ngcontent-%COMP%]{position:absolute;width:100%;z-index:0}.percent[_ngcontent-%COMP%]{margin:0 0 2px!important;font-size:1.4rem!important;font-weight:600!important;line-height:1.5!important;z-index:1!important;position:relative!important;text-align:center}.dcp-loader-green[_ngcontent-%COMP%]{margin:0!important;padding:0!important;position:absolute;height:20px!important;float:left;z-index:0}.fadein-out[_ngcontent-%COMP%]{transition:all .1s ease-in-out}.progress-materializecss[_ngcontent-%COMP%]{position:relative;height:4px;display:block;width:100%;background-color:#42e5bd;border-radius:2px;margin:0;overflow:hidden}.progress-materializecss[_ngcontent-%COMP%]   .indeterminate[_ngcontent-%COMP%]{background-color:#0e6751}.progress-materializecss[_ngcontent-%COMP%]   .indeterminate[_ngcontent-%COMP%]:before{-webkit-animation:indeterminate 2.1s cubic-bezier(.65,.815,.735,.395) infinite;animation:indeterminate 2.1s cubic-bezier(.65,.815,.735,.395) infinite}.progress-materializecss[_ngcontent-%COMP%]   .indeterminate[_ngcontent-%COMP%]:after, .progress-materializecss[_ngcontent-%COMP%]   .indeterminate[_ngcontent-%COMP%]:before{content:"";position:absolute;background-color:inherit;top:0;left:0;bottom:0;will-change:left,right}.progress-materializecss[_ngcontent-%COMP%]   .indeterminate[_ngcontent-%COMP%]:after{-webkit-animation:indeterminate-short 2.1s cubic-bezier(.165,.84,.44,1) infinite;animation:indeterminate-short 2.1s cubic-bezier(.165,.84,.44,1) infinite;-webkit-animation-delay:1.15s;animation-delay:1.15s}.close-containers[_ngcontent-%COMP%]{width:100%;top:0}.close-end[_ngcontent-%COMP%]{position:absolute;display:block;height:25px;width:25px;right:10px;top:10px;background:#fff;border-radius:50%;z-index:9999}@-webkit-keyframes indeterminate{0%{left:-35%;right:100%}60%{left:100%;right:-90%}to{left:100%;right:-90%}}@keyframes indeterminate{0%{left:-35%;right:100%}60%{left:100%;right:-90%}to{left:100%;right:-90%}}@-webkit-keyframes indeterminate-short{0%{left:-200%;right:100%}60%{left:107%;right:-8%}to{left:107%;right:-8%}}@keyframes indeterminate-short{0%{left:-200%;right:100%}60%{left:107%;right:-8%}to{left:107%;right:-8%}}.progress-container[_ngcontent-%COMP%]{width:100%}']}),t})()}];let L=(()=>{class t{}return t.\u0275mod=f.Jb({type:t}),t.\u0275inj=f.Ib({factory:function(s){return new(s||t)},imports:[[a.i.forChild(D)],a.i]}),t})(),B=(()=>{class t{}return t.\u0275mod=f.Jb({type:t}),t.\u0275inj=f.Ib({factory:function(s){return new(s||t)},imports:[[i.b,n.f,o.N,L]]}),t})()}}]);