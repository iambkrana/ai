(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{"nbU/":function(t,s,i){"use strict";i.d(s,"a",(function(){return f}));var e=i("mrSG"),n=i("wd/R"),o=i("FAH8"),r=i("X7yx"),a=i("5dVO"),d=i("riPR"),h=i("ZJFI"),c=i("1vjY"),l=i("fXoL"),m=i("TEn/"),_=i("ofXK");const p=["publisherContainer"],u=["videoContainer"];function g(t,s){if(1&t&&(l.Ob(0,"div",7),l.Ob(1,"div",17),l.Ob(2,"div",18),l.mc(3),l.Nb(),l.Nb(),l.Nb()),2&t){const t=l.Yb();l.Ab(3),l.oc(" ",null==t.timer?null:t.timer.secondsRemaining," ")}}var b=function(t){return t[t.Online=0]="Online",t[t.Offline=1]="Offline",t}({});let f=(()=>{class t{constructor(t,s,i,e,n,o,r,a,d,h,c,l){this.platform=t,this.alertController=s,this.menu=i,this.navCtrl=e,this.modalCtrl=n,this.file=o,this.zone=r,this.events=a,this.ionLoader=d,this.ionAlert=h,this.database=c,this.atom=l,this.btn_isclicked=!1,this.json_profile={user_id:"",company_id:"",company_name:"",first_name:"",last_name:"",fullname:"",email:"",mobile:"",photo:"",co_photo:"",otp_pending:"",otc_pending:"",co_pending:"",token_no:"",payload:"",webauto_login:"",default_dboard_tab:""},this.recording_completed=!1,this.recording_disconnected=!1,this.IsRecordingInterrupted=!1,this.blobs=[],this.chunks=[],this.showCamera=!1,this.json_video_assessment={company_id:"",assessment_id:"",trans_id:"",question_id:"",video_url:"",addeddate:"",question:"",session_id:"",token_id:"",archive_id:"",start_time:"",end_time:"",current_status:"",percentage:0,progressbar_title:"",cont_color:"",pbar_color:"",pbfont_color:"",upload_status:"PENDING",is_uploaded:0,file_size:0},this.json_start_archive={action:"start_archive",token_no:"",payload:"",sessionId:"",tokenId:"",fileName:""},this.json_stop_archive={action:"stop_archive",token_no:"",payload:"",sessionId:"",tokenId:"",archiveId:""},this.json_session={apiKey:"",sessionId:"",tokenId:"",archiveId:"",fileName:""},this.isTimerInit=!1,this.LOCK_RECORDING_BUTTON_PERIOD=0,this.lock_button=!0,this.json_assessment_data=[],this.internet_indicator=!1,this.close_assessment=!1,this.close_assessment=!1,this.menu.enable(!1),this.zone.run(()=>{this.lock_button=!0,this.showCamera=!1,this.recording_disconnected=!1,this.IsRecordingInterrupted=!1}),this.assessment_messages=this.atom.get_assessment_messages()}ngOnInit(){this.user_id=this.param_user_id,this.assessment_detail=this.param_assessment_detail,this.question_detail=this.param_question_detail,this.session_details=this.param_session_details,this.global_messages=this.param_global_messages}ngAfterViewInit(){this.platform.ready().then(()=>{""===this.question_detail.company_id||""===this.question_detail.trans_id||""===this.question_detail.question_id?this.atom.presentToast("Application error, Parameter missing."):this.initializeApp()})}initializeApp(){this.platform.ready().then(t=>{window.addEventListener("online",()=>{this.internetStatus=b.Online,this.zone.run(()=>{this.internet_background="int-green",this.internet_text="YOU ARE ONLINE"}),this.internet_timer=setTimeout(()=>{this.zone.run(()=>{this.internet_indicator=!1})},1e4)}),window.addEventListener("offline",()=>{this.internetStatus=b.Offline,this.zone.run(()=>{this.internet_background="int-red",this.internet_text="YOU ARE OFFLINE",this.internet_indicator=!0})}),this.database.storage_get("device").then(t=>{t.token_no&&t.payload&&(this.json_profile=t,""===this.json_profile.user_id||""===this.question_detail.company_id||""===this.question_detail.trans_id||""===this.question_detail.question_id?this.atom.presentToast("Application error, Parameter missing."):(this.json_video_assessment.company_id=this.question_detail.company_id,this.json_video_assessment.assessment_id="0",this.json_video_assessment.trans_id=this.question_detail.trans_id,this.json_video_assessment.question_id=this.question_detail.question_id,this.json_video_assessment.question=this.question_detail.question,this.file_name=this.json_profile.user_id+"_"+this.question_detail.question_id+"_"+n().utcOffset("+05:30").format("YYYYMMDDHHmmss")+".mp4",this.json_video_assessment.video_url=this.file_name,this.json_video_assessment.addeddate=n().utcOffset("+05:30").format("YYYY-MM-DD HH:mm:ss"),this.assessment_id="0",this.json_session.fileName=this.file_name,this.json_session.apiKey=this.session_details.apiKey,this.json_session.sessionId=this.session_details.sessionId,this.json_session.tokenId=this.session_details.tokenId,this.json_start_archive.token_no=t.token_no,this.json_start_archive.payload=t.payload,this.json_start_archive.sessionId=this.json_session.sessionId,this.json_start_archive.tokenId=this.json_session.tokenId,this.json_start_archive.fileName=this.file_name,this.json_stop_archive.token_no=t.token_no,this.json_stop_archive.payload=t.payload,this.json_stop_archive.sessionId=this.json_session.sessionId,this.json_stop_archive.tokenId=this.json_session.tokenId,this.json_video_assessment.session_id=this.json_session.sessionId,this.json_video_assessment.token_id=this.json_session.tokenId,this.timeInSeconds=parseInt(this.question_detail.response_timer),this.recording_completed=!1,this.load_camera()))}).catch(t=>{})})}getSecondsAsDigitalClock(t){const s=parseInt(t.toString(),10),i=Math.floor(s/3600),e=Math.floor((s-3600*i)/60),n=s-3600*i-60*e;let o="",r="",a="";return o=i<10?"0"+i:i.toString(),r=e<10?"0"+e:e.toString(),a=n<10?"0"+n:n.toString(),o+":"+r+":"+a}startTimer(){this.json_video_assessment.start_time=n().utcOffset("+05:30").format("YYYY-MM-DD HH:mm:ss"),this.timer.hasStarted=!0,this.timer.runTimer=!0,this.timerTick()}pauseTimer(){this.timer.runTimer=!1}nextQuestion(){1==this.isTimerInit?this.stopTimer():(this.timeInSeconds=0,this.stopRecording())}stopTimer(){1==this.isTimerInit&&this.zone.run(()=>{this.timeInSeconds=0,this.timer.secondsRemaining=0,this.timer.runTimer=!1,this.timer.hasStarted=!1,this.timer.hasFinished=!0})}resumeTimer(){this.startTimer()}timerTick(){setTimeout(()=>{if(0==this.close_assessment)if(this.internetStatus===b.Offline)this.RecordingInterrupted();else{if(!this.timer.runTimer)return void this.stopRecording();this.zone.run(()=>{this.timer.secondsRemaining--}),this.question_countdown=this.timer.secondsRemaining,this.timer.displayTime=this.getSecondsAsDigitalClock(this.timer.secondsRemaining),this.timer.secondsRemaining>0?this.timerTick():(this.timer.hasFinished=!0,this.stopRecording())}},1e3)}initTimer(){this.isTimerInit=!0,this.timeInSeconds||(this.timeInSeconds=0),this.timer={seconds:this.timeInSeconds,runTimer:!1,hasStarted:!1,hasFinished:!1,secondsRemaining:this.timeInSeconds},this.timer.displayTime=this.getSecondsAsDigitalClock(this.timer.secondsRemaining),this.startTimer()}ionViewCanLeave(){this.stopTimer()}ionViewWillUnload(){this.stopTimer()}pathForImage(t){return null===t||""===t||void 0===t?this.atom.getImagePath()+"assets/uploads/avatar/no-avatar.jpg":this.atom.getImagePath()+"assets/uploads/avatar/"+t}pathForLogoImage(t){return null===t||""===t||void 0===t?this.atom.getImagePath()+"assets/uploads/company/no-logo.jpg":this.atom.getImagePath()+"assets/uploads/company/"+t}RecordingInterrupted(){return Object(e.a)(this,void 0,void 0,(function*(){if(0==this.IsRecordingInterrupted){this.IsRecordingInterrupted=!0;try{this.zone.run(()=>{this.timeInSeconds=0,this.stopTimer(),this.recording_disconnected=!0,this.showCamera=!1});try{yield this.publisher.publishVideo(!1)}catch(t){}try{yield this.publisher.destroy()}catch(t){}try{yield this.session.unpublish(this.publisher)}catch(t){}try{yield this.session.disconnect()}catch(t){}try{this.publisher=null}catch(t){}try{this.session.off()}catch(t){}try{this.session=null}catch(t){}try{OT.updateViews()}catch(t){}this.modalCtrl.dismiss({repeat_question:"Y"})}catch(t){this.modalCtrl.dismiss({repeat_question:"Y"})}}}))}stopRecording(){return Object(e.a)(this,void 0,void 0,(function*(){if(this.internetStatus===b.Offline)this.json_video_assessment.end_time=n().utcOffset("+05:30").format("YYYY-MM-DD HH:mm:ss"),this.RecordingInterrupted();else try{if(1==this.recording_disconnected)this.json_video_assessment.end_time=n().utcOffset("+05:30").format("YYYY-MM-DD HH:mm:ss"),this.RecordingInterrupted();else{this.zone.run(()=>{this.showCamera=!1});try{yield this.publisher.publishVideo(!1)}catch(t){}try{yield this.publisher.destroy()}catch(t){}try{this.json_video_assessment.end_time=n().utcOffset("+05:30").format("YYYY-MM-DD HH:mm:ss"),yield this.session.unpublish(this.publisher)}catch(t){}try{yield this.session.disconnect()}catch(t){}try{this.publisher=null}catch(t){}try{this.session.off()}catch(t){}try{this.session=null}catch(t){}try{OT.updateViews()}catch(t){}if(this.internetStatus===b.Offline)this.RecordingInterrupted();else try{this.atom.http_post(this.json_stop_archive).subscribe(t=>{1==t.success?this.database.storage_get("assessment_demo").then(t=>Object(e.a)(this,void 0,void 0,(function*(){this.json_assessment_data=t&&Object.keys(t).length>0?yield t:[],yield this.json_assessment_data.push(this.json_video_assessment),yield this.database.storage_set("assessment_demo",this.json_assessment_data).then(t=>{this.zone.run(()=>{this.showCamera=!1,this.recording_completed=!0,this.modalCtrl.dismiss({repeat_question:"N"})})}).catch(t=>{this.RecordingInterrupted()})}))).catch(t=>{}):this.RecordingInterrupted()},t=>{this.RecordingInterrupted()},()=>{})}catch(t){this.RecordingInterrupted()}}}catch(t){}}))}start_archive(){try{this.atom.http_post(this.json_start_archive).subscribe(t=>{if(1==t.success){this.json_session.archiveId=t.archiveId,this.json_stop_archive.archiveId=t.archiveId,this.json_video_assessment.archive_id=t.archiveId,this.publisher=OT.initPublisher("publisher",{fitMode:"cover",insertMode:"append",width:"100%",height:"100%",showControls:!1,style:{nameDisplayMode:"off",buttonDisplayMode:"off",audioBlockedDisplayMode:"off"}}),this.session.publish(this.publisher);try{OT.updateViews()}catch(s){}if(this.zone.run(()=>{this.showCamera=!0}),Object.keys(this.assessment_messages).length>0)if(parseFloat(this.assessment_messages.LOCK_RECORDING_BUTTON_PERIOD)>0){let t=1e3*parseFloat(this.assessment_messages.LOCK_RECORDING_BUTTON_PERIOD);setTimeout(()=>{this.zone.run(()=>{this.lock_button=!1})},t)}else this.zone.run(()=>{this.lock_button=!1});else this.zone.run(()=>{this.lock_button=!1});this.timeInSeconds<=0?this.stopTimer():this.initTimer()}else this.RecordingInterrupted()},t=>{this.RecordingInterrupted()},()=>{})}catch(t){this.RecordingInterrupted()}}load_camera(){if(this.internetStatus===b.Offline)this.zone.run(()=>{this.showCamera=!1}),this.modalCtrl.dismiss({repeat_question:"Y"});else try{this.session=OT.initSession(this.json_session.apiKey,this.json_session.sessionId),this.session.on({streamDestroyed:t=>{OT.updateViews(),"networkDisconnected"!==t.reason&&"mediaStopped"!==t.reason||(this.recording_disconnected=!0,this.RecordingInterrupted())},sessionConnected:t=>{this.start_archive()},sessionDisconnected:t=>{this.recording_disconnected=!0,this.RecordingInterrupted()}}),this.session.connect(this.json_session.tokenId,t=>{t?(this.recording_disconnected=!0,this.RecordingInterrupted()):setTimeout(()=>{this.internetStatus===b.Offline&&(this.recording_disconnected=!0,this.RecordingInterrupted())},5e3)})}catch(t){this.recording_disconnected=!0,this.RecordingInterrupted()}}backto_dashboard(){return Object(e.a)(this,void 0,void 0,(function*(){this.close_assessment=!0,this.stopTimer(),this.zone.run(()=>{this.showCamera=!1});try{yield this.publisher.publishVideo(!1)}catch(t){}try{yield this.publisher.destroy()}catch(t){}try{yield this.session.unpublish(this.publisher)}catch(t){}try{yield this.session.disconnect()}catch(t){}try{this.publisher=null}catch(t){}try{this.session.off()}catch(t){}try{this.session=null}catch(t){}try{OT.updateViews()}catch(t){}this.modalCtrl.dismiss({repeat_question:"CLOSE"})}))}}return t.\u0275fac=function(s){return new(s||t)(l.Lb(m.T),l.Lb(m.b),l.Lb(m.Q),l.Lb(m.S),l.Lb(m.R),l.Lb(o.a),l.Lb(l.z),l.Lb(d.a),l.Lb(a.a),l.Lb(r.a),l.Lb(h.a),l.Lb(c.a))},t.\u0275cmp=l.Fb({type:t,selectors:[["app-assessment-demo-recording-ios"]],viewQuery:function(t,s){var i;1&t&&(l.qc(p,!0),l.qc(u,!0)),2&t&&(l.ec(i=l.Xb())&&(s.publisherContainer=i.first),l.ec(i=l.Xb())&&(s.videoContainer=i.first))},inputs:{timeInSeconds:"timeInSeconds",param_user_id:"param_user_id",param_assessment_detail:"param_assessment_detail",param_question_detail:"param_question_detail",param_vimeo_credentials:"param_vimeo_credentials",param_session_details:"param_session_details",param_global_messages:"param_global_messages"},decls:20,vars:5,consts:[["content-bg",""],[1,"please-container",3,"hidden"],["id","videos",1,"ion-no-margin","ion-no-padding","dcpvids",3,"hidden"],["publisherContainer",""],[1,"close-containers"],["src","assets/images/close.png","alt","",1,"close-end",3,"click"],["id","publisher"],[1,"timer-container"],[1,"recording-block"],["color","secondary",1,"assessment-badge-red"],[1,"recording-icon"],["class","timer-container",4,"ngIf"],[1,"ion-no-margin","ion-no-padding","ion-no-border","ion-no-shadow","reshoot-panel",3,"hidden"],[1,"ion-no-margin","ion-no-padding"],["align-items-end","",1,"ion-no-margin","ion-no-padding"],[1,"ion-no-margin","ion-no-padding","ion-text-center"],["size","small","fill","solid","expand","block",1,"custom-button",3,"disabled","click"],[1,"timer-block"],[1,"timer-text"]],template:function(t,s){1&t&&(l.Ob(0,"ion-content",0),l.Ob(1,"div",1),l.mc(2," Please wait camera loading... "),l.Nb(),l.Ob(3,"div",2,3),l.Ob(5,"div",4),l.Ob(6,"img",5),l.Wb("click",(function(){return s.backto_dashboard()})),l.Nb(),l.Nb(),l.Mb(7,"div",6),l.Ob(8,"div",7),l.Ob(9,"div",8),l.Ob(10,"ion-badge",9),l.Mb(11,"div",10),l.mc(12,"\xa0RECORDING"),l.Nb(),l.Nb(),l.Nb(),l.lc(13,g,4,1,"div",11),l.Nb(),l.Nb(),l.Ob(14,"ion-footer",12),l.Ob(15,"ion-grid",13),l.Ob(16,"ion-row",14),l.Ob(17,"ion-col",15),l.Ob(18,"ion-button",16),l.Wb("click",(function(){return s.nextQuestion()})),l.mc(19," Next Question "),l.Nb(),l.Nb(),l.Nb(),l.Nb(),l.Nb()),2&t&&(l.Ab(1),l.bc("hidden",s.showCamera),l.Ab(2),l.bc("hidden",!s.showCamera),l.Ab(10),l.bc("ngIf",s.timeInSeconds>0),l.Ab(1),l.bc("hidden",!s.showCamera),l.Ab(4),l.bc("disabled",s.lock_button))},directives:[m.m,m.g,_.i,m.o,m.p,m.B,m.l,m.h],styles:["#publisher[_ngcontent-%COMP%], #videos[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%!important;height:100%!important;-o-object-fit:cover;object-fit:cover}#publisher[_ngcontent-%COMP%], #videos[_ngcontent-%COMP%], .content-bg[_ngcontent-%COMP%]{margin:0!important;padding:0!important;text-align:center}.content-bg[_ngcontent-%COMP%]{background-color:#fff!important}.recording-icon[_ngcontent-%COMP%]{height:8px;width:8px;background-color:#fff;border-radius:50%;display:inline-block}.assessment-badge-red[_ngcontent-%COMP%]{padding:4px 10px 3px!important;background-color:#d71d1e;font-size:1rem;font-weight:600}.assessment-badge-green[_ngcontent-%COMP%]{padding:4px 10px 3px!important;background-color:#28c0a7;font-size:1rem;font-weight:400}.reshoot-panel[_ngcontent-%COMP%]{background-color:transparent;height:75px;width:100%;text-align:center}.timer-container[_ngcontent-%COMP%]{background-color:transparent!important;display:block;position:absolute;top:0;height:auto;width:100%;display:flex!important;align-content:right!important;align-items:right!important;text-align:right;float:right;z-index:99}.recording-block[_ngcontent-%COMP%]{margin:30px 0 0 30px}.recording-block[_ngcontent-%COMP%], .timer-block[_ngcontent-%COMP%]{width:50px;height:50px;text-align:right;vertical-align:center;border:0 solid}.timer-block[_ngcontent-%COMP%]{margin:15px 40px 0 auto}.timer-text[_ngcontent-%COMP%]{background-color:#54419a;width:45px;height:45px;border-radius:50%;text-align:center;vertical-align:middle;font-size:2rem;font-weight:800;color:#fff;padding:12px 0 0}.please-container[_ngcontent-%COMP%]{font-size:1.6rem;font-weight:600;display:flex;justify-content:center;align-items:center;height:100%;color:#000}.fab-md[_ngcontent-%COMP%]{box-shadow:none!important}.dcpvids[_ngcontent-%COMP%]{position:fixed;margin:0!important;padding:0!important;top:0;left:0;width:100%!important;height:auto!important;-o-object-fit:cover;object-fit:cover;text-align:center}.custom-button[_ngcontent-%COMP%]{width:90%!important;font-family:Roboto,sans-serif;font-size:1.4rem;font-weight:400;text-transform:none;--box-shadow:none;--border-radius:0px;--background:var(--ion-color-primary);--background-focused:var(--ion-color-primary);--background-hover:var(--ion-color-primary);--color:var(--ion-color-primary-contrast);margin:0;display:-webkit-inline-box!important;transition:none}.close-containers[_ngcontent-%COMP%]{width:100%}.close-end[_ngcontent-%COMP%]{position:absolute;display:block;height:25px;width:25px;right:10px;top:10px;background:#fff;border-radius:50%;z-index:9999}"]}),t})()}}]);