function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{"nbU/":function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var s=n("mrSG"),i=n("wd/R"),o=n("FAH8"),r=n("X7yx"),a=n("5dVO"),c=n("riPR"),d=n("ZJFI"),u=n("1vjY"),h=n("fXoL"),l=n("TEn/"),m=n("ofXK"),p=["publisherContainer"],_=["videoContainer"];function f(e,t){if(1&e&&(h.Ob(0,"div",7),h.Ob(1,"div",17),h.Ob(2,"div",18),h.mc(3),h.Nb(),h.Nb(),h.Nb()),2&e){var n=h.Yb();h.Ab(3),h.oc(" ",null==n.timer?null:n.timer.secondsRemaining," ")}}var g=function(e){return e[e.Online=0]="Online",e[e.Offline=1]="Offline",e}({}),b=function(){var e=function(){function e(t,n,s,i,o,r,a,c,d,u,h,l){var m=this;_classCallCheck(this,e),this.platform=t,this.alertController=n,this.menu=s,this.navCtrl=i,this.modalCtrl=o,this.file=r,this.zone=a,this.events=c,this.ionLoader=d,this.ionAlert=u,this.database=h,this.atom=l,this.btn_isclicked=!1,this.json_profile={user_id:"",company_id:"",company_name:"",first_name:"",last_name:"",fullname:"",email:"",mobile:"",photo:"",co_photo:"",otp_pending:"",otc_pending:"",co_pending:"",token_no:"",payload:"",webauto_login:"",default_dboard_tab:""},this.recording_completed=!1,this.recording_disconnected=!1,this.IsRecordingInterrupted=!1,this.blobs=[],this.chunks=[],this.showCamera=!1,this.json_video_assessment={company_id:"",assessment_id:"",trans_id:"",question_id:"",video_url:"",addeddate:"",question:"",session_id:"",token_id:"",archive_id:"",start_time:"",end_time:"",current_status:"",percentage:0,progressbar_title:"",cont_color:"",pbar_color:"",pbfont_color:"",upload_status:"PENDING",is_uploaded:0,file_size:0},this.json_start_archive={action:"start_archive",token_no:"",payload:"",sessionId:"",tokenId:"",fileName:""},this.json_stop_archive={action:"stop_archive",token_no:"",payload:"",sessionId:"",tokenId:"",archiveId:""},this.json_session={apiKey:"",sessionId:"",tokenId:"",archiveId:"",fileName:""},this.isTimerInit=!1,this.LOCK_RECORDING_BUTTON_PERIOD=0,this.lock_button=!0,this.json_assessment_data=[],this.internet_indicator=!1,this.close_assessment=!1,this.close_assessment=!1,this.menu.enable(!1),this.zone.run((function(){m.lock_button=!0,m.showCamera=!1,m.recording_disconnected=!1,m.IsRecordingInterrupted=!1})),this.assessment_messages=this.atom.get_assessment_messages()}return _createClass(e,[{key:"ngOnInit",value:function(){this.user_id=this.param_user_id,this.assessment_detail=this.param_assessment_detail,this.question_detail=this.param_question_detail,this.session_details=this.param_session_details,this.global_messages=this.param_global_messages}},{key:"ngAfterViewInit",value:function(){var e=this;this.platform.ready().then((function(){""===e.question_detail.company_id||""===e.question_detail.trans_id||""===e.question_detail.question_id?e.atom.presentToast("Application error, Parameter missing."):e.initializeApp()}))}},{key:"initializeApp",value:function(){var e=this;this.platform.ready().then((function(t){window.addEventListener("online",(function(){e.internetStatus=g.Online,e.zone.run((function(){e.internet_background="int-green",e.internet_text="YOU ARE ONLINE"})),e.internet_timer=setTimeout((function(){e.zone.run((function(){e.internet_indicator=!1}))}),1e4)})),window.addEventListener("offline",(function(){e.internetStatus=g.Offline,e.zone.run((function(){e.internet_background="int-red",e.internet_text="YOU ARE OFFLINE",e.internet_indicator=!0}))})),e.database.storage_get("device").then((function(t){t.token_no&&t.payload&&(e.json_profile=t,""===e.json_profile.user_id||""===e.question_detail.company_id||""===e.question_detail.trans_id||""===e.question_detail.question_id?e.atom.presentToast("Application error, Parameter missing."):(e.json_video_assessment.company_id=e.question_detail.company_id,e.json_video_assessment.assessment_id="0",e.json_video_assessment.trans_id=e.question_detail.trans_id,e.json_video_assessment.question_id=e.question_detail.question_id,e.json_video_assessment.question=e.question_detail.question,e.file_name=e.json_profile.user_id+"_"+e.question_detail.question_id+"_"+i().utcOffset("+05:30").format("YYYYMMDDHHmmss")+".mp4",e.json_video_assessment.video_url=e.file_name,e.json_video_assessment.addeddate=i().utcOffset("+05:30").format("YYYY-MM-DD HH:mm:ss"),e.assessment_id="0",e.json_session.fileName=e.file_name,e.json_session.apiKey=e.session_details.apiKey,e.json_session.sessionId=e.session_details.sessionId,e.json_session.tokenId=e.session_details.tokenId,e.json_start_archive.token_no=t.token_no,e.json_start_archive.payload=t.payload,e.json_start_archive.sessionId=e.json_session.sessionId,e.json_start_archive.tokenId=e.json_session.tokenId,e.json_start_archive.fileName=e.file_name,e.json_stop_archive.token_no=t.token_no,e.json_stop_archive.payload=t.payload,e.json_stop_archive.sessionId=e.json_session.sessionId,e.json_stop_archive.tokenId=e.json_session.tokenId,e.json_video_assessment.session_id=e.json_session.sessionId,e.json_video_assessment.token_id=e.json_session.tokenId,e.timeInSeconds=parseInt(e.question_detail.response_timer),e.recording_completed=!1,e.load_camera()))})).catch((function(e){}))}))}},{key:"getSecondsAsDigitalClock",value:function(e){var t=parseInt(e.toString(),10),n=Math.floor(t/3600),s=Math.floor((t-3600*n)/60),i=t-3600*n-60*s;return(n<10?"0"+n:n.toString())+":"+(s<10?"0"+s:s.toString())+":"+(i<10?"0"+i:i.toString())}},{key:"startTimer",value:function(){this.json_video_assessment.start_time=i().utcOffset("+05:30").format("YYYY-MM-DD HH:mm:ss"),this.timer.hasStarted=!0,this.timer.runTimer=!0,this.timerTick()}},{key:"pauseTimer",value:function(){this.timer.runTimer=!1}},{key:"nextQuestion",value:function(){1==this.isTimerInit?this.stopTimer():(this.timeInSeconds=0,this.stopRecording())}},{key:"stopTimer",value:function(){var e=this;1==this.isTimerInit&&this.zone.run((function(){e.timeInSeconds=0,e.timer.secondsRemaining=0,e.timer.runTimer=!1,e.timer.hasStarted=!1,e.timer.hasFinished=!0}))}},{key:"resumeTimer",value:function(){this.startTimer()}},{key:"timerTick",value:function(){var e=this;setTimeout((function(){if(0==e.close_assessment)if(e.internetStatus===g.Offline)e.RecordingInterrupted();else{if(!e.timer.runTimer)return void e.stopRecording();e.zone.run((function(){e.timer.secondsRemaining--})),e.question_countdown=e.timer.secondsRemaining,e.timer.displayTime=e.getSecondsAsDigitalClock(e.timer.secondsRemaining),e.timer.secondsRemaining>0?e.timerTick():(e.timer.hasFinished=!0,e.stopRecording())}}),1e3)}},{key:"initTimer",value:function(){this.isTimerInit=!0,this.timeInSeconds||(this.timeInSeconds=0),this.timer={seconds:this.timeInSeconds,runTimer:!1,hasStarted:!1,hasFinished:!1,secondsRemaining:this.timeInSeconds},this.timer.displayTime=this.getSecondsAsDigitalClock(this.timer.secondsRemaining),this.startTimer()}},{key:"ionViewCanLeave",value:function(){this.stopTimer()}},{key:"ionViewWillUnload",value:function(){this.stopTimer()}},{key:"pathForImage",value:function(e){return null===e||""===e||void 0===e?this.atom.getImagePath()+"assets/uploads/avatar/no-avatar.jpg":this.atom.getImagePath()+"assets/uploads/avatar/"+e}},{key:"pathForLogoImage",value:function(e){return null===e||""===e||void 0===e?this.atom.getImagePath()+"assets/uploads/company/no-logo.jpg":this.atom.getImagePath()+"assets/uploads/company/"+e}},{key:"RecordingInterrupted",value:function(){return Object(s.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!=this.IsRecordingInterrupted){e.next=42;break}return this.IsRecordingInterrupted=!0,e.prev=2,this.zone.run((function(){t.timeInSeconds=0,t.stopTimer(),t.recording_disconnected=!0,t.showCamera=!1})),e.prev=4,e.next=7,this.publisher.publishVideo(!1);case 7:e.next=11;break;case 9:e.prev=9,e.t0=e.catch(4);case 11:return e.prev=11,e.next=14,this.publisher.destroy();case 14:e.next=18;break;case 16:e.prev=16,e.t1=e.catch(11);case 18:return e.prev=18,e.next=21,this.session.unpublish(this.publisher);case 21:e.next=25;break;case 23:e.prev=23,e.t2=e.catch(18);case 25:return e.prev=25,e.next=28,this.session.disconnect();case 28:e.next=32;break;case 30:e.prev=30,e.t3=e.catch(25);case 32:try{this.publisher=null}catch(n){}try{this.session.off()}catch(n){}try{this.session=null}catch(n){}try{OT.updateViews()}catch(n){}this.modalCtrl.dismiss({repeat_question:"Y"}),e.next=42;break;case 39:e.prev=39,e.t4=e.catch(2),this.modalCtrl.dismiss({repeat_question:"Y"});case 42:case"end":return e.stop()}}),e,this,[[2,39],[4,9],[11,16],[18,23],[25,30]])})))}},{key:"stopRecording",value:function(){return Object(s.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.internetStatus!==g.Offline){e.next=4;break}this.json_video_assessment.end_time=i().utcOffset("+05:30").format("YYYY-MM-DD HH:mm:ss"),this.RecordingInterrupted(),e.next=48;break;case 4:if(e.prev=4,1!=this.recording_disconnected){e.next=9;break}this.json_video_assessment.end_time=i().utcOffset("+05:30").format("YYYY-MM-DD HH:mm:ss"),this.RecordingInterrupted(),e.next=44;break;case 9:return this.zone.run((function(){t.showCamera=!1})),e.prev=10,e.next=13,this.publisher.publishVideo(!1);case 13:e.next=17;break;case 15:e.prev=15,e.t0=e.catch(10);case 17:return e.prev=17,e.next=20,this.publisher.destroy();case 20:e.next=24;break;case 22:e.prev=22,e.t1=e.catch(17);case 24:return e.prev=24,this.json_video_assessment.end_time=i().utcOffset("+05:30").format("YYYY-MM-DD HH:mm:ss"),e.next=28,this.session.unpublish(this.publisher);case 28:e.next=32;break;case 30:e.prev=30,e.t2=e.catch(24);case 32:return e.prev=32,e.next=35,this.session.disconnect();case 35:e.next=39;break;case 37:e.prev=37,e.t3=e.catch(32);case 39:try{this.publisher=null}catch(n){}try{this.session.off()}catch(n){}try{this.session=null}catch(n){}try{OT.updateViews()}catch(n){}if(this.internetStatus===g.Offline)this.RecordingInterrupted();else try{this.atom.http_post(this.json_stop_archive).subscribe((function(e){1==e.success?t.database.storage_get("assessment_demo").then((function(e){return Object(s.a)(t,void 0,void 0,regeneratorRuntime.mark((function t(){var n=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e&&Object.keys(e).length>0)){t.next=6;break}return t.next=3,e;case 3:t.t0=t.sent,t.next=7;break;case 6:t.t0=[];case 7:return this.json_assessment_data=t.t0,t.next=10,this.json_assessment_data.push(this.json_video_assessment);case 10:return t.next=12,this.database.storage_set("assessment_demo",this.json_assessment_data).then((function(e){n.zone.run((function(){n.showCamera=!1,n.recording_completed=!0,n.modalCtrl.dismiss({repeat_question:"N"})}))})).catch((function(e){n.RecordingInterrupted()}));case 12:case"end":return t.stop()}}),t,this)})))})).catch((function(e){})):t.RecordingInterrupted()}),(function(e){t.RecordingInterrupted()}),(function(){}))}catch(n){this.RecordingInterrupted()}case 44:e.next=48;break;case 46:e.prev=46,e.t4=e.catch(4);case 48:case"end":return e.stop()}}),e,this,[[4,46],[10,15],[17,22],[24,30],[32,37]])})))}},{key:"start_archive",value:function(){var e=this;try{this.atom.http_post(this.json_start_archive).subscribe((function(t){if(1==t.success){e.json_session.archiveId=t.archiveId,e.json_stop_archive.archiveId=t.archiveId,e.json_video_assessment.archive_id=t.archiveId,e.publisher=OT.initPublisher("publisher",{fitMode:"cover",insertMode:"append",width:"100%",height:"100%",showControls:!1,style:{nameDisplayMode:"off",buttonDisplayMode:"off",audioBlockedDisplayMode:"off"}}),e.session.publish(e.publisher);try{OT.updateViews()}catch(s){}if(e.zone.run((function(){e.showCamera=!0})),Object.keys(e.assessment_messages).length>0)if(parseFloat(e.assessment_messages.LOCK_RECORDING_BUTTON_PERIOD)>0){var n=1e3*parseFloat(e.assessment_messages.LOCK_RECORDING_BUTTON_PERIOD);setTimeout((function(){e.zone.run((function(){e.lock_button=!1}))}),n)}else e.zone.run((function(){e.lock_button=!1}));else e.zone.run((function(){e.lock_button=!1}));e.timeInSeconds<=0?e.stopTimer():e.initTimer()}else e.RecordingInterrupted()}),(function(t){e.RecordingInterrupted()}),(function(){}))}catch(t){this.RecordingInterrupted()}}},{key:"load_camera",value:function(){var e=this;if(this.internetStatus===g.Offline)this.zone.run((function(){e.showCamera=!1})),this.modalCtrl.dismiss({repeat_question:"Y"});else try{this.session=OT.initSession(this.json_session.apiKey,this.json_session.sessionId),this.session.on({streamDestroyed:function(t){OT.updateViews(),"networkDisconnected"!==t.reason&&"mediaStopped"!==t.reason||(e.recording_disconnected=!0,e.RecordingInterrupted())},sessionConnected:function(t){e.start_archive()},sessionDisconnected:function(t){e.recording_disconnected=!0,e.RecordingInterrupted()}}),this.session.connect(this.json_session.tokenId,(function(t){t?(e.recording_disconnected=!0,e.RecordingInterrupted()):setTimeout((function(){e.internetStatus===g.Offline&&(e.recording_disconnected=!0,e.RecordingInterrupted())}),5e3)}))}catch(t){this.recording_disconnected=!0,this.RecordingInterrupted()}}},{key:"backto_dashboard",value:function(){return Object(s.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.close_assessment=!0,this.stopTimer(),this.zone.run((function(){t.showCamera=!1})),e.prev=1,e.next=4,this.publisher.publishVideo(!1);case 4:e.next=8;break;case 6:e.prev=6,e.t0=e.catch(1);case 8:return e.prev=8,e.next=11,this.publisher.destroy();case 11:e.next=15;break;case 13:e.prev=13,e.t1=e.catch(8);case 15:return e.prev=15,e.next=18,this.session.unpublish(this.publisher);case 18:e.next=22;break;case 20:e.prev=20,e.t2=e.catch(15);case 22:return e.prev=22,e.next=25,this.session.disconnect();case 25:e.next=29;break;case 27:e.prev=27,e.t3=e.catch(22);case 29:try{this.publisher=null}catch(n){}try{this.session.off()}catch(n){}try{this.session=null}catch(n){}try{OT.updateViews()}catch(n){}this.modalCtrl.dismiss({repeat_question:"CLOSE"});case 34:case"end":return e.stop()}}),e,this,[[1,6],[8,13],[15,20],[22,27]])})))}}]),e}();return e.\u0275fac=function(t){return new(t||e)(h.Lb(l.T),h.Lb(l.b),h.Lb(l.Q),h.Lb(l.S),h.Lb(l.R),h.Lb(o.a),h.Lb(h.z),h.Lb(c.a),h.Lb(a.a),h.Lb(r.a),h.Lb(d.a),h.Lb(u.a))},e.\u0275cmp=h.Fb({type:e,selectors:[["app-assessment-demo-recording-ios"]],viewQuery:function(e,t){var n;1&e&&(h.qc(p,!0),h.qc(_,!0)),2&e&&(h.ec(n=h.Xb())&&(t.publisherContainer=n.first),h.ec(n=h.Xb())&&(t.videoContainer=n.first))},inputs:{timeInSeconds:"timeInSeconds",param_user_id:"param_user_id",param_assessment_detail:"param_assessment_detail",param_question_detail:"param_question_detail",param_vimeo_credentials:"param_vimeo_credentials",param_session_details:"param_session_details",param_global_messages:"param_global_messages"},decls:20,vars:5,consts:[["content-bg",""],[1,"please-container",3,"hidden"],["id","videos",1,"ion-no-margin","ion-no-padding","dcpvids",3,"hidden"],["publisherContainer",""],[1,"close-containers"],["src","assets/images/close.png","alt","",1,"close-end",3,"click"],["id","publisher"],[1,"timer-container"],[1,"recording-block"],["color","secondary",1,"assessment-badge-red"],[1,"recording-icon"],["class","timer-container",4,"ngIf"],[1,"ion-no-margin","ion-no-padding","ion-no-border","ion-no-shadow","reshoot-panel",3,"hidden"],[1,"ion-no-margin","ion-no-padding"],["align-items-end","",1,"ion-no-margin","ion-no-padding"],[1,"ion-no-margin","ion-no-padding","ion-text-center"],["size","small","fill","solid","expand","block",1,"custom-button",3,"disabled","click"],[1,"timer-block"],[1,"timer-text"]],template:function(e,t){1&e&&(h.Ob(0,"ion-content",0),h.Ob(1,"div",1),h.mc(2," Please wait camera loading... "),h.Nb(),h.Ob(3,"div",2,3),h.Ob(5,"div",4),h.Ob(6,"img",5),h.Wb("click",(function(){return t.backto_dashboard()})),h.Nb(),h.Nb(),h.Mb(7,"div",6),h.Ob(8,"div",7),h.Ob(9,"div",8),h.Ob(10,"ion-badge",9),h.Mb(11,"div",10),h.mc(12,"\xa0RECORDING"),h.Nb(),h.Nb(),h.Nb(),h.lc(13,f,4,1,"div",11),h.Nb(),h.Nb(),h.Ob(14,"ion-footer",12),h.Ob(15,"ion-grid",13),h.Ob(16,"ion-row",14),h.Ob(17,"ion-col",15),h.Ob(18,"ion-button",16),h.Wb("click",(function(){return t.nextQuestion()})),h.mc(19," Next Question "),h.Nb(),h.Nb(),h.Nb(),h.Nb(),h.Nb()),2&e&&(h.Ab(1),h.bc("hidden",t.showCamera),h.Ab(2),h.bc("hidden",!t.showCamera),h.Ab(10),h.bc("ngIf",t.timeInSeconds>0),h.Ab(1),h.bc("hidden",!t.showCamera),h.Ab(4),h.bc("disabled",t.lock_button))},directives:[l.m,l.g,m.i,l.o,l.p,l.B,l.l,l.h],styles:["#publisher[_ngcontent-%COMP%], #videos[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%!important;height:100%!important;-o-object-fit:cover;object-fit:cover}#publisher[_ngcontent-%COMP%], #videos[_ngcontent-%COMP%], .content-bg[_ngcontent-%COMP%]{margin:0!important;padding:0!important;text-align:center}.content-bg[_ngcontent-%COMP%]{background-color:#fff!important}.recording-icon[_ngcontent-%COMP%]{height:8px;width:8px;background-color:#fff;border-radius:50%;display:inline-block}.assessment-badge-red[_ngcontent-%COMP%]{padding:4px 10px 3px!important;background-color:#d71d1e;font-size:1rem;font-weight:600}.assessment-badge-green[_ngcontent-%COMP%]{padding:4px 10px 3px!important;background-color:#28c0a7;font-size:1rem;font-weight:400}.reshoot-panel[_ngcontent-%COMP%]{background-color:transparent;height:75px;width:100%;text-align:center}.timer-container[_ngcontent-%COMP%]{background-color:transparent!important;display:block;position:absolute;top:0;height:auto;width:100%;display:flex!important;align-content:right!important;align-items:right!important;text-align:right;float:right;z-index:99}.recording-block[_ngcontent-%COMP%]{margin:30px 0 0 30px}.recording-block[_ngcontent-%COMP%], .timer-block[_ngcontent-%COMP%]{width:50px;height:50px;text-align:right;vertical-align:center;border:0 solid}.timer-block[_ngcontent-%COMP%]{margin:15px 40px 0 auto}.timer-text[_ngcontent-%COMP%]{background-color:#54419a;width:45px;height:45px;border-radius:50%;text-align:center;vertical-align:middle;font-size:2rem;font-weight:800;color:#fff;padding:12px 0 0}.please-container[_ngcontent-%COMP%]{font-size:1.6rem;font-weight:600;display:flex;justify-content:center;align-items:center;height:100%;color:#000}.fab-md[_ngcontent-%COMP%]{box-shadow:none!important}.dcpvids[_ngcontent-%COMP%]{position:fixed;margin:0!important;padding:0!important;top:0;left:0;width:100%!important;height:auto!important;-o-object-fit:cover;object-fit:cover;text-align:center}.custom-button[_ngcontent-%COMP%]{width:90%!important;font-family:Roboto,sans-serif;font-size:1.4rem;font-weight:400;text-transform:none;--box-shadow:none;--border-radius:0px;--background:var(--ion-color-primary);--background-focused:var(--ion-color-primary);--background-hover:var(--ion-color-primary);--color:var(--ion-color-primary-contrast);margin:0;display:-webkit-inline-box!important;transition:none}.close-containers[_ngcontent-%COMP%]{width:100%}.close-end[_ngcontent-%COMP%]{position:absolute;display:block;height:25px;width:25px;right:10px;top:10px;background:#fff;border-radius:50%;z-index:9999}"]}),e}()}}]);